# JSON Schema for templates.yaml validation
# See ADR-003 for design documentation.

$schema: "http://json-schema.org/draft-07/schema#"
title: "Amiable Templates Registry"
description: "Schema for validating Railway deployment template registry"
type: object
additionalProperties: false

required:
  - version
  - templates

properties:
  version:
    type: string
    pattern: "^\\d+\\.\\d+$"
    description: "Schema version (e.g., '1.0')"

  settings:
    type: object
    properties:
      github_api:
        type: object
        properties:
          require_token:
            type: boolean
          concurrency:
            type: integer
            minimum: 1
            maximum: 20
      cache:
        type: object
        properties:
          directory:
            type: string
          manifest:
            type: string
      output:
        type: object
        properties:
          docs_directory:
            type: string

  categories:
    type: array
    items:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          pattern: "^[a-z][a-z0-9-]*$"
          description: "Category identifier (lowercase, hyphens allowed)"
        name:
          type: string
          description: "Display name for category"
        icon:
          type: string
          description: "Material icon identifier"
        description:
          type: string
          description: "Category description"

  templates:
    type: array
    minItems: 1
    items:
      type: object
      additionalProperties: false
      required:
        - id
        - repo
        - title
        - description
        - category
        - directories
      properties:
        id:
          type: string
          pattern: "^[a-z][a-z0-9-]*$"
          description: "Template identifier (lowercase, hyphens allowed)"

        repo:
          type: object
          required:
            - owner
            - name
          properties:
            owner:
              type: string
              description: "GitHub organization or user"
            name:
              type: string
              description: "Repository name"

        title:
          type: string
          description: "Display title"

        description:
          type: string
          description: "Brief description for template grid"

        value_proposition:
          type: string
          description: "One-line value proposition"

        category:
          type: string
          pattern: "^[a-z][a-z0-9-]*$"
          description: "Category ID reference"

        tags:
          type: array
          items:
            type: string
          description: "Tags for filtering/search"

        tier:
          type: string
          enum:
            - starter
            - production
            - stable
            - beta
            - experimental
          description: "Template maturity tier"

        directories:
          type: object
          required:
            - docs
          properties:
            template:
              type: string
              description: "Path to template directory in repo"
            docs:
              type: array
              minItems: 1
              items:
                type: object
                required:
                  - path
                  - target
                properties:
                  path:
                    type: string
                    description: "Source path in repository"
                  target:
                    type: string
                    description: "Target filename in docs"
                  sidebar_label:
                    type: string
                    description: "Display name in sidebar"
            adrs:
              type: array
              items:
                type: object
                required:
                  - path
                properties:
                  path:
                    type: string
                    description: "Path to ADR directory"

        links:
          type: object
          properties:
            railway_template:
              type: string
              format: uri
              description: "Railway deploy URL"
            github:
              type: string
              format: uri
              description: "GitHub repository URL"

        features:
          type: array
          items:
            type: string
          description: "Feature highlights for template card"

        estimated_cost:
          type: object
          properties:
            min:
              type: number
              minimum: 0
              description: "Minimum monthly cost"
            max:
              type: number
              minimum: 0
              description: "Maximum monthly cost"
            currency:
              type: string
              default: "USD"
            period:
              type: string
              enum:
                - month
                - year
              default: "month"

        relates_to:
          type: array
          items:
            type: object
            required:
              - template_id
              - relationship
            properties:
              template_id:
                type: string
                description: "Related template ID"
              relationship:
                type: string
                enum:
                  - production_version
                  - starter_version
                  - alternative
                  - depends_on
                description: "Type of relationship"
